<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EXTRANEF - Sistema de Gestão</title>
    <link rel="stylesheet" href="style-electron.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <h1><i class="fas fa-chart-line"></i> EXTRANEF - Sistema de Gestão</h1>
        <nav class="nav">
          <a href="index-electron.html" class="nav-link active"
            ><i class="fas fa-home"></i> Início</a
          >
          <a href="funcionarios.html" class="nav-link"
            ><i class="fas fa-users"></i> Funcionários</a
          >
          <a href="faltas.html" class="nav-link"
            ><i class="fas fa-calendar-times"></i> Faltas</a
          >
          <a href="ferias.html" class="nav-link"
            ><i class="fas fa-umbrella-beach"></i> Férias</a
          >
          <a href="atestados.html" class="nav-link"
            ><i class="fas fa-file-medical"></i> Atestados</a
          >
          <a href="adm-electron.html" class="nav-link"
            ><i class="fas fa-cog"></i> Administração</a
          >
        </nav>
      </header>

      <!-- Conteúdo Principal -->
      <main class="main-content">
        <!-- Estatísticas Gerais -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <h3>Total de Funcionários</h3>
              <p class="stat-number" id="totalFuncionarios">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-calendar-times"></i>
            </div>
            <div class="stat-content">
              <h3>Faltas Este Mês</h3>
              <p class="stat-number" id="faltasMes">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-file-medical"></i>
            </div>
            <div class="stat-content">
              <h3>Atestados Ativos</h3>
              <p class="stat-number" id="atestadosAtivos">0</p>
            </div>
          </div>
          </div>
        </div>

        <!-- Acesso Rápido -->
        <div class="quick-access">
          <h2><i class="fas fa-bolt"></i> Acesso Rápido</h2>
          <div class="quick-grid">
            <a href="funcionarios.html" class="quick-card">
              <div class="quick-icon">
                <i class="fas fa-user-plus"></i>
              </div>
              <h3>Cadastrar Funcionário</h3>
              <p>Adicionar novo funcionário ao sistema</p>
            </a>
            <a href="faltas.html" class="quick-card">
              <div class="quick-icon">
                <i class="fas fa-calendar-plus"></i>
              </div>
              <h3>Registrar Falta</h3>
              <p>Registrar ausência de funcionário</p>
            </a>
            <a href="atestados.html" class="quick-card">
              <div class="quick-icon">
                <i class="fas fa-upload"></i>
              </div>
              <h3>Upload Atestado</h3>
              <p>Enviar atestado médico (PDF/PNG)</p>
            </a>
          </div>
        </div>

        <!-- Atividades Recentes -->
        <div class="recent-activities">
          <h2><i class="fas fa-history"></i> Atividades Recentes</h2>
          <div class="activities-list" id="activitiesList">
            <!-- Atividades serão carregadas dinamicamente -->
          </div>
        </div>

        <!-- Resumo do Sistema -->
        <div class="system-summary">
          <h2><i class="fas fa-info-circle"></i> Sobre o Sistema</h2>
          <div class="summary-content">
            <p>
              O <strong>EXTRANEF</strong> é um sistema completo de gestão
              empresarial desenvolvido para controle de equipe, produtividade e
              comissões. Com funcionalidades avançadas de cadastro de
              funcionários, gestão de faltas, férias e atestados, o sistema
              oferece uma solução integrada para empresas que precisam de
              controle total sobre seus recursos humanos.
            </p>
            <div class="features-grid">
              <div class="feature-item">
                <i class="fas fa-shield-alt"></i>
                <h4>Segurança</h4>
                <p>Dados armazenados localmente com backup automático</p>
              </div>
              <div class="feature-item">
                <i class="fas fa-sync-alt"></i>
                <h4>Sincronização</h4>
                <p>Importação e exportação de dados em múltiplos formatos</p>
              </div>
              <div class="feature-item">
                <i class="fas fa-mobile-alt"></i>
                <h4>Responsivo</h4>
                <p>Interface adaptável para todos os dispositivos</p>
              </div>
              <div class="feature-item">
                <i class="fas fa-download"></i>
                <h4>Portabilidade</h4>
                <p>Aplicativo desktop executável independente</p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Scripts -->
    <script src="ui.js"></script>
    <script src="database.js"></script>
    <script>
      // Carregar dados da página inicial
      document.addEventListener("DOMContentLoaded", function () {
        carregarEstatisticas();
        carregarAtividadesRecentes();
      });

      function carregarEstatisticas() {
        try {
          // Total de funcionários
          const funcionarios = extranefDB.getFuncionarios();
          document.getElementById("totalFuncionarios").textContent =
            funcionarios.length;

          // Faltas deste mês
          const faltas = extranefDB.getFaltas();
          const hoje = new Date();
          const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
          const faltasMes = faltas.filter(
            (f) => new Date(f.dataFalta) >= inicioMes
          );
          document.getElementById("faltasMes").textContent = faltasMes.length;

          // Atestados ativos
          const atestados = extranefDB.getAtestados();
          const hojeStr = hoje.toISOString().split("T")[0];
          const atestadosAtivos = atestados.filter((a) => a.dataFim >= hojeStr);
          document.getElementById("atestadosAtivos").textContent =
            atestadosAtivos.length;

        } catch (error) {
          console.error("Erro ao carregar estatísticas:", error);
        }
      }

      function carregarAtividadesRecentes() {
        try {
          const funcionarios = extranefDB.getFuncionarios();
          const faltas = extranefDB.getFaltas();
          const atestados = extranefDB.getAtestados();
          const ferias = extranefDB.getFerias();

          // Combinar todas as atividades
          let atividades = [];

          // Adicionar faltas
          faltas.forEach((falta) => {
            const funcionario = funcionarios.find(
              (f) => f.id === falta.funcionarioId
            );
            if (funcionario) {
              atividades.push({
                tipo: "falta",
                data: new Date(falta.dataFalta),
                descricao: `Falta registrada para ${funcionario.nome}`,
                funcionario: funcionario.nome,
              });
            }
          });

          // Adicionar atestados
          atestados.forEach((atestado) => {
            const funcionario = funcionarios.find(
              (f) => f.id === atestado.funcionarioId
            );
            if (funcionario) {
              atividades.push({
                tipo: "atestado",
                data: new Date(atestado.dataRegistro),
                descricao: `Atestado registrado para ${funcionario.nome}`,
                funcionario: funcionario.nome,
              });
            }
          });

          // Adicionar férias
          ferias.forEach((feria) => {
            const funcionario = funcionarios.find(
              (f) => f.id === feria.funcionarioId
            );
            if (funcionario) {
              atividades.push({
                tipo: "ferias",
                data: new Date(feria.dataRegistro),
                descricao: `Férias registradas para ${funcionario.nome}`,
                funcionario: funcionario.nome,
              });
            }
          });

          // Ordenar por data (mais recentes primeiro)
          atividades.sort((a, b) => b.data - a.data);

          // Mostrar apenas as 10 mais recentes
          const atividadesRecentes = atividades.slice(0, 10);

          const activitiesList = document.getElementById("activitiesList");
          activitiesList.innerHTML = "";

          if (atividadesRecentes.length === 0) {
            activitiesList.innerHTML =
              '<p class="text-muted">Nenhuma atividade registrada ainda.</p>';
            return;
          }

          atividadesRecentes.forEach((atividade) => {
            const activityDiv = document.createElement("div");
            activityDiv.className = "activity-item";

            const iconClass =
              {
                falta: "fas fa-calendar-times text-danger",
                atestado: "fas fa-file-medical text-warning",
                ferias: "fas fa-umbrella-beach text-info",
              }[atividade.tipo] || "fas fa-info-circle";

            activityDiv.innerHTML = `
                        <div class="activity-icon">
                            <i class="${iconClass}"></i>
                        </div>
                        <div class="activity-content">
                            <h4>${atividade.descricao}</h4>
                            <p class="activity-date">${atividade.data.toLocaleDateString(
                              "pt-BR"
                            )}</p>
                        </div>
                    `;

            activitiesList.appendChild(activityDiv);
          });
        } catch (error) {
          console.error("Erro ao carregar atividades:", error);
        }
      }
    </script>
  </body>
</html>
